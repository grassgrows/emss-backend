-- apply changes
create table image (
  id                            bigint generated by default as identity not null,
  image_id                      varchar(255) not null,
  name                          varchar(255) not null,
  repository                    varchar(255) not null,
  tag                           varchar(255) not null,
  when_created                  timestamp not null,
  when_modified                 timestamp not null,
  constraint pk_image primary key (id)
);

create table server (
  id                            bigint generated by default as identity not null,
  container_id                  varchar(255) not null,
  name                          varchar(255) not null,
  alias_name                    varchar(255) not null,
  abbr                          varchar(255) not null,
  location                      varchar(255) not null,
  start_command                 varchar(255) not null,
  last_crash_date               timestamp,
  last_start_date               timestamp,
  image_id                      bigint not null,
  container_port                integer not null,
  host_port                     integer not null,
  when_created                  timestamp not null,
  when_modified                 timestamp not null,
  constraint uq_server_image_id unique (image_id),
  constraint pk_server primary key (id)
);

create table setting (
  type                          integer generated by default as identity not null,
  value                         varchar(255) not null,
  when_created                  timestamp not null,
  when_modified                 timestamp not null,
  constraint ck_setting_type check ( type in (0,1)),
  constraint pk_setting primary key (type)
);

create table user (
  id                            bigint generated by default as identity not null,
  username                      varchar(255) not null,
  password                      varchar(255) not null,
  permission_level              varchar(255) not null,
  when_created                  timestamp not null,
  when_modified                 timestamp not null,
  constraint pk_user primary key (id)
);

create table user_server (
  id                            bigint generated by default as identity not null,
  user_id                       bigint not null,
  server_id                     bigint not null,
  when_created                  timestamp not null,
  when_modified                 timestamp not null,
  constraint pk_user_server primary key (id)
);

alter table server add constraint fk_server_image_id foreign key (image_id) references image (id) on delete restrict on update restrict;

