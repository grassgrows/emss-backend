<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<migration xmlns="http://ebean-orm.github.io/xml/ns/dbmigration">
    <changeSet type="apply">
        <addColumn tableName="server">
            <column name="port_bindings" type="jsonb" notnull="true"/>
            <column name="volume_bind" type="jsonb" notnull="true"/>
        </addColumn>
        <createTable name="server_port_bindings" pkName="pk_server_port_bindings">
            <column name="id" type="bigint" primaryKey="true"/>
            <column name="container_id" type="bigint" notnull="true"/>
            <column name="host_port" type="integer" notnull="true"/>
            <column name="container_port" type="integer" notnull="true"/>
            <column name="when_created" type="timestamp" notnull="true"/>
            <column name="when_modified" type="timestamp" notnull="true"/>
        </createTable>
        <createTable name="server_volume_bind" pkName="pk_server_volume_bind">
            <column name="id" type="bigint" primaryKey="true"/>
            <column name="container_id" type="bigint" notnull="true"/>
            <column name="host_volume_path" type="varchar" notnull="true"/>
            <column name="container_volume_path" type="varchar" notnull="true"/>
            <column name="when_created" type="timestamp" notnull="true"/>
            <column name="when_modified" type="timestamp" notnull="true"/>
        </createTable>
        <alterColumn columnName="type" tableName="setting" checkConstraint="check ( type in (0,1,2,3))" checkConstraintName="ck_setting_type"/>
    </changeSet>
    <changeSet type="pendingDrops">
        <dropColumn columnName="image_id" tableName="image"/>
        <dropColumn columnName="container_port" tableName="server"/>
        <dropColumn columnName="host_port" tableName="server"/>
        <dropTable name="server_vo"/>
    </changeSet>
</migration>